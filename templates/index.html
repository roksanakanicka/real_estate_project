<!-- templates/index.html -->
<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Wyszukiwarka mieszkań</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        table { border-collapse: collapse; width: 100%; margin-top: 20px; }
        th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
        th { background-color: #f2f2f2; }
        input[type="number"] { width: 80px; }
        select { width: 100px; }
    </style>
</head>
<body>
<h1>Wyszukiwarka mieszkań na sprzedaż</h1>

<form method="POST">
    Miasto: 
    <select name="city">
        <option value="">Dowolne</option>
        {% for city in cities %}
            <option value="{{ city }}" {% if filters.get('city') == city %}selected{% endif %}>
                {{ city_map[city] }}
            </option>
        {% endfor %}
    </select>
    <br><br>

    Minimalna liczba pokoi: 
    <input type="number" name="min_rooms" min="1" step="1"
    value="{{ filters.get('min_rooms','') }}">
    <br><br>


    Metraż (m²): 
    Od: <input type="number" name="min_square"
    value="{{ filters.get('min_square',50) }}">

    Do: <input type="number" name="max_square"
    value="{{ filters.get('max_square',100) }}">
    <br><br>


    Cena:
    Od: <input type="number" name="min_price"
    value="{{ filters.get('min_price',100000) }}">

    Do: <input type="number" name="max_price"
    value="{{ filters.get('max_price',500000) }}">
    <br><br>

    Minimalne piętro:
    <input type="number" name="min_floor"
    value="{{ filters.get('min_floor','') }}">
    <br><br>

    Maksymalna liczba pięter w budynku:
    <input type="number" name="max_floor_count"
    value="{{ filters.get('max_floor_count','') }}">
    <br><br>

    Przedszkole w pobliżu: 
    <select name="kindergarten">
        <option value="" {% if filters.get('kindergarten')=='' %}selected{% endif %}>
            Dowolne
        </option>

        <option value="yes" {% if filters.get('kindergarten')=='yes' %}selected{% endif %}>
            Tak
        </option>
    </select>
    <br><br>

    Szkoła w pobliżu: 
    <select name="school">
        <option value="" {% if filters.get('school')=='' %}selected{% endif %}>
            Dowolne
        </option>

        <option value="yes" {% if filters.get('school')=='yes' %}selected{% endif %}>
            Tak
        </option>
    </select>
    <br><br>

    Balkon: 
    <select name="balcony">
        <option value="" {% if filters.get('balcony')=='' %}selected{% endif %}>Dowolne</option>
        <option value="yes" {% if filters.get('balcony')=='yes' %}selected{% endif %}>Tak</option>
    </select><br><br>

    Winda: 
    <select name="elevator">
        <option value="" {% if filters.get('elevator')=='' %}selected{% endif %}>Dowolne</option>
        <option value="yes" {% if filters.get('elevator')=='yes' %}selected{% endif %}>Tak</option>
    </select><br><br>

    Parking: 
    <select name="parking">
        <option value="" {% if filters.get('parking')=='' %}selected{% endif %}>Dowolne</option>
        <option value="yes" {% if filters.get('parking')=='yes' %}selected{% endif %}>Tak</option>
    </select><br><br>

    Sortuj według: 
    <select name="sort_by">
        <option value="" {% if sort_by=='' %}selected{% endif %}>Brak</option>
        <option value="rooms" {% if sort_by=='rooms' %}selected{% endif %}>Pokoje</option>
        <option value="squareMeters" {% if sort_by=='squareMeters' %}selected{% endif %}>Metraż (m²)</option>
        <option value="floor" {% if sort_by=='floor' %}selected{% endif %}>Piętro</option>
        <option value="floorCount" {% if sort_by=='floorCount' %}selected{% endif %}>Liczba pięter</option>
        <option value="price" {% if sort_by=='price' %}selected{% endif %}>Cena</option>
        <option value="kindergartenDistance" {% if sort_by=='kindergartenDistance' %}selected{% endif %}>Przedszkole (km)</option>
        <option value="schoolDistance" {% if sort_by=='schoolDistance' %}selected{% endif %}>Szkoła (km)</option>
    </select>
    <br><br>

    <input type="submit" value="Szukaj">
</form>

<h2>Wyniki:</h2>
<table>
    <tr>
        <th>Miasto</th>
        <th>Pokoje</th>
        <th>Metraż (m²)</th>
        <th>Piętro</th>
        <th>Liczba pięter</th>
        <th>Cena</th>
        <th>Przedszkole (km)</th>
        <th>Szkoła (km)</th>
        <th>Balkon</th>
        <th>Winda</th>
        <th>Parking</th>
    </tr>
    {% for row in results %}
    <tr>
        <td>{{ city_map.get(row["city"], row["city"]) }}</td>
        <td>{{ row["rooms"]|int }}</td>
        <td>{{ "{:.2f}".format(row["squareMeters"]).replace('.',',') }}</td>
        <td>{{ row["floor"]|int }}</td>
        <td>{{ row["floorCount"]|int }}</td>
        <td>{{ "{:,.0f}".format(row["price"]).replace(',', ' ') }} zł</td>
        <td>{{ "{:.2f}".format(row["kindergartenDistance"]).replace('.',',') }} km</td>
        <td>{{ "{:.2f}".format(row["schoolDistance"]).replace('.',',') }} km</td>
        <td>{{ 'Tak' if row["hasBalcony"]=='yes' else 'Nie' }}</td>
        <td>{{ 'Tak' if row["hasElevator"]=='yes' else 'Nie' }}</td>
        <td>{{ 'Tak' if row["hasParkingSpace"]=='yes' else 'Nie' }}</td>
    </tr>
    {% endfor %}
</table>
</body>
</html>
